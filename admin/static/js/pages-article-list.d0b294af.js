(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-article-list"],{"0e5c":function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"page-body"},[a("vk-data-table-query",{attrs:{columns:t.queryForm1.columns,size:"mini"},on:{search:function(e){arguments[0]=e=t.$handleEvent(e),t.search.apply(void 0,arguments)}},model:{value:t.queryForm1.formData,callback:function(e){t.$set(t.queryForm1,"formData",e)},expression:"queryForm1.formData"}}),a("v-uni-view",{staticClass:"btns-box"},[a("el-row",[a("el-radio-group",{attrs:{size:"mini"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.search.apply(void 0,arguments)}},model:{value:t.queryForm1.formData.status,callback:function(e){t.$set(t.queryForm1.formData,"status",e)},expression:"queryForm1.formData.status"}},[a("el-badge",{staticClass:"group-badge",attrs:{value:t.statusCountGroup[0]>0?t.statusCountGroup[0]:"",max:999}},[a("el-radio-button",{attrs:{label:0}},[t._v("已发布")])],1),a("el-badge",{staticClass:"group-badge",attrs:{value:t.statusCountGroup[1]>0?t.statusCountGroup[1]:"",max:999}},[a("el-radio-button",{attrs:{label:1}},[t._v("已下架")])],1),a("el-radio-button",{attrs:{label:2}},[t._v("回收站")])],1),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"success",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.addBtn.apply(void 0,arguments)}}},[t._v("添加")]),t.table1.multipleSelection?a("el-dropdown",{attrs:{"split-button":!1,trigger:"click"},on:{command:function(e){arguments[0]=e=t.$handleEvent(e),t.batchBtn.apply(void 0,arguments)}}},[a("el-button",{staticStyle:{"margin-left":"20rpx"},attrs:{type:"danger",size:"mini",disabled:0===t.table1.multipleSelection.length}},[t._v("批量操作"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:1}},[t._v("批量发布")]),a("el-dropdown-item",{attrs:{command:2}},[t._v("批量下架")]),a("el-dropdown-item",{attrs:{command:3}},[t._v("批量删除")]),a("el-dropdown-item",{attrs:{command:4}},[t._v("批量恢复")])],1)],1):t._e()],1)],1),a("el-container",[a("el-aside",{staticStyle:{"margin-top":"10px"},attrs:{width:"125px"}},[a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:t.category.loading,expression:"category.loading"}],attrs:{data:t.category.list,props:t.category.props,"highlight-current":!0},on:{"node-click":function(e){arguments[0]=e=t.$handleEvent(e),t.categoryChange.apply(void 0,arguments)}}})],1),a("el-main",{staticStyle:{padding:"0"}},[a("vk-data-table",{ref:"table1",attrs:{action:t.table1.action,columns:t.table1.columns,"query-form-param":t.queryForm1,"right-btns":["detail_auto","update","more"],"right-btns-more":t.table1.rightBtnsMore,selection:!0,"row-no":!1,pagination:!0,size:"mini"},on:{update:function(e){arguments[0]=e=t.$handleEvent(e),t.updateBtn.apply(void 0,arguments)},delete:function(e){arguments[0]=e=t.$handleEvent(e),t.deleteBtn.apply(void 0,arguments)},"current-change":function(e){arguments[0]=e=t.$handleEvent(e),t.currentChange.apply(void 0,arguments)},"selection-change":function(e){arguments[0]=e=t.$handleEvent(e),t.selectionChange.apply(void 0,arguments)},"custom-right-btns":function(e){arguments[0]=e=t.$handleEvent(e),t.customRightBtns.apply(void 0,arguments)}},scopedSlots:t._u([{key:"sort",fn:function(e){var n=e.row;e.column,e.index;return[a("el-input",{attrs:{size:"mini"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.sortChange(e,n)}},model:{value:n.sort,callback:function(e){t.$set(n,"sort",e)},expression:"row.sort"}})]}}])})],1)],1),a("previewArticle",{model:{value:t.formDatas.previewArticle,callback:function(e){t.$set(t.formDatas,"previewArticle",e)},expression:"formDatas.previewArticle"}})],1)},i=[]},"161a":function(t,e,a){"use strict";a.r(e);var n=a("94b8"),i=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);e["default"]=i.a},"39a7":function(t,e,a){"use strict";a.r(e);var n=a("0e5c"),i=a("75fb");for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);a("ab3f3");var l=a("828b"),r=Object(l["a"])(i["default"],n["b"],n["c"],!1,null,"785ea254",null,!1,n["a"],void 0);e["default"]=r.exports},"45a3":function(t,e,a){var n=a("c86c");e=n(!1),e.push([t.i,".page-body .sort-input[data-v-785ea254]{font-size:12px}.page-body[data-v-785ea254]  .el-tree-node__content{height:40px;font-weight:600}.page-body .group-badge[data-v-785ea254]  .el-badge__content.is-fixed{z-index:2;right:20px;text-align:right}",""]),t.exports=e},"6dec":function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){return n}));var n={vkDataMobilePreview:a("fde9").default},i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("vk-data-drawer",{attrs:{title:t.page.title,top:t.page.top,width:t.page.width,"close-on-click-modal":!0},on:{open:function(e){arguments[0]=e=t.$handleEvent(e),t.onOpen.apply(void 0,arguments)},closed:function(e){arguments[0]=e=t.$handleEvent(e),t.onClose.apply(void 0,arguments)}},model:{value:t.value.show,callback:function(e){t.$set(t.value,"show",e)},expression:"value.show"}},[a("vk-data-mobile-preview",{attrs:{type:t.mobile.type,url:t.value.url}}),a("v-uni-view",{staticClass:"preview-drawer-btn"},[a("v-uni-button",{staticClass:"el-button table-btn el-button--default is-round",class:{active:"iphone"===t.mobile.type},attrs:{type:"button"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.mobile.type="iphone"}}},[a("span",[t._v("iphone")])]),a("v-uni-button",{staticClass:"el-button table-btn el-button--default is-round",class:{active:"iphonex"===t.mobile.type},attrs:{type:"button"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.mobile.type="iphonex"}}},[a("span",[t._v("iphonex")])]),a("v-uni-button",{staticClass:"el-button table-btn el-button--default is-round",class:{active:"qrcode"===t.mobile.type},attrs:{type:"button"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.mobile.type="qrcode"}}},[a("span",[t._v("二维码")])]),a("v-uni-button",{staticClass:"el-button return-btn el-button--default is-round",attrs:{type:"button"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.close.apply(void 0,arguments)}}},[a("i",{staticClass:"el-icon-back"}),a("span",[t._v("返回")])])],1)],1)},o=[]},"75fb":function(t,e,a){"use strict";a.r(e);var n=a("774f"),i=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);e["default"]=i.a},"774f":function(t,e,a){"use strict";a("6a54");var n=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(a("9b1b")),o=n(a("39d8"));a("fd3c"),a("c223"),a("5ef2"),a("3efd"),a("aa9c"),a("5c47"),a("af8f"),a("64aa");var l,r=n(a("8afb")),c=uni.vk,u={components:{previewArticle:r.default},data:function(){var t=this;return{loading:!1,statusCountGroup:{},category:{list:[],props:{children:"children",label:"name"},countObj:{},loading:!1},data:{},table1:{action:"admin/sys.article.getList",columns:[{key:"sort",title:"排序",type:"number",width:80,defaultValue:"0",sortable:"custom"},{key:"image",title:"文章图",type:"avatar",imageWidth:40,shape:"square"},{key:"name",title:"文章名称",type:"text",width:160,align:"left",maxlength:20,showWordLimit:!0,buttonsPosition:"left",buttons:[{title:"修改",type:"text",mode:"update",show:["row"],showRule:function(t){return 1!=t.key2},click:function(t){l.updateBaseInfo({data:t.formData,success:function(e){t.success({msg:"修改成功"})}})}}]},{key:"description",title:"文章描述",type:"text",width:160,defaultValue:"暂无",show:["detail"]},{key:"categoryList",title:"所属分类",type:"text",width:140,defaultValue:"暂无",formatter:function(t,e,a,n){var i="";return t.map((function(t,e){e>0&&(i+="、"),i+=t.name})),i}},{key:"is_publish",title:"是否发布",type:"switch",width:80,watch:function(t){var e=t.value,a=t.row,n=t.change;c.callFunction({url:"admin/sys.article.updateIsPublish",title:e?"发布中...":"下架中...",data:{ids:[a._id],is_on_sale:e},success:function(t){n(e)}})}},{key:"keywords",title:"文章关键字",type:"text",width:100,defaultValue:"暂无"},{key:"count.view",title:"累计浏览量",type:"number",width:140,defaultValue:0,sortable:"custom"},{key:"count.comment",title:"累计评价数",type:"number",width:140,defaultValue:0,sortable:"custom"},{key:"publish_time",title:"发布时间",type:"time",width:160},{key:"is_recommend",title:"是否推荐",type:"switch",activeValue:!0,inactiveValue:!1,width:80,watch:function(t){var e=t.value,a=t.row,n=t.column,i=t.change;l.updateBaseInfo({data:(0,o.default)({_id:a._id},n.key,e),success:function(t){i(e)}})}},{key:"is_new",title:"是否最新",type:"switch",activeValue:!0,inactiveValue:!1,width:80,watch:function(t){var e=t.value,a=t.row,n=t.column,i=t.change;l.updateBaseInfo({data:(0,o.default)({_id:a._id},n.key,e),success:function(t){i(e)}})}},{key:"is_hot",title:"是否热门",type:"switch",activeValue:!0,inactiveValue:!1,width:80,watch:function(t){var e=t.value,a=t.row,n=t.column,i=t.change;l.updateBaseInfo({data:(0,o.default)({_id:a._id},n.key,e),success:function(t){i(e)}})}},{key:"_add_time",title:"创建时间",type:"time",width:180},{key:"update_time",title:"修改时间",type:"dateDiff",width:160,defaultValue:"无"},{key:"_id",title:"文章ID",type:"text",width:210},{key:"images",title:"文章轮播图",type:"image",width:200,show:["detail"]}],multipleSelection:[],selectItem:"",rightBtnsMore:[{title:"预览",onClick:function(e){var a=c.getVuex("$user.mchInfo.h5")||{},n=a.domain,i=a.path;if(n){var o;o=i?"".concat(n,"/").concat(i):n;var l="/pages/article/detail?_id=".concat(e._id),r=o+l;c.pubfn.openForm("previewArticle",{url:r})}else t.$confirm("请先前往平台管理-h5，设置服务域名","提示",{confirmButtonText:"立即前往",cancelButtonText:"取消",type:"warning"}).then((function(){c.navigateTo("/pages/platform/h5")})).catch((function(){}))}},{title:"复制页面地址",onClick:function(t){var e="/pages/article/detail?_id=".concat(t._id);uni.setClipboardData({data:e,success:function(){console.log("success"),c.toast("成功复制页面"+e)}})}},{title:"复制创建",onClick:function(t){l.copyNewArticle(t)}},{title:"删除",onClick:function(t){l.deleteArticle(t._id)},show:function(t){return[0,1,2].indexOf(t.status)>-1}}]},queryForm1:{formData:{status:0,name:"",_add_time:[],category_ids:""},columns:[{key:"name",type:"text",title:"",placeholder:"请输入文章名称",width:220,mode:"%%"},{key:"_add_time",type:"datetimerange",title:"添加时间",width:320,mode:"[]"},{key:"category_ids",type:"text",title:"分类",width:320,mode:"in",show:!1}]},formDatas:{}}},onLoad:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l=this,c=l.vk,l.options=t,l.init(t)},onReady:function(){},onShow:function(){},onHide:function(){},methods:{init:function(t){t.msg&&setTimeout((function(){l.$notify({message:"操作成功!",type:"success"})}),100),l.getCategory(),l.getStatusCountGroup()},getStatusCountGroup:function(){c.callFunction({url:"admin/sys.article.getStatusCountGroup",data:{},success:function(t){l.statusCountGroup=t.group}})},getCategory:function(){c.callFunction({url:"admin/sys.category.kh_getList",loading:{name:"category.loading",that:l},data:{formData:{type:"article",enable:!0},columns:[{key:"type",mode:"%%"},{key:"enable",mode:"="}]},success:function(t){t.rows.unshift({_id:"",name:"全部"}),l.category.list=t.rows}})},pageTo:function(t){c.navigateTo(t)},search:function(t){l.$refs.table1.query(t),l.getStatusCountGroup()},refresh:function(){l.$refs.table1.refresh(),l.getStatusCountGroup()},getCurrentRow:function(t){return l.$refs.table1.getCurrentRow(t)},currentChange:function(t){l.table1.selectItem=t},selectionChange:function(t){l.table1.multipleSelection=t},addBtn:function(){c.navigateTo({url:"./edit?mode=add",events:{add:function(t){l.refresh()}}})},updateBtn:function(t){t.item;var e=t.row;c.navigateTo({url:"./edit?mode=update&_id=".concat(e._id),events:{update:function(t){c.pubfn.objectAssign(e,t)}}})},deleteBtn:function(t){var e=t.item,a=t.deleteFn;a({action:"admin/sys.article.delete",data:{_id:e._id}})},batchBtn:function(t){switch(t){case 0:l.updateCategory();break;case 1:l.updateIsPublish(!0);break;case 2:l.updateIsPublish(!1);break;case 3:l.deleteArticle();break;case 4:l.recoveryArticle();break;default:break}},copyNewArticle:function(t){l.$message({message:"复制成功,将为您打开添加页面!",type:"success",duration:600}),setTimeout((function(){c.navigateTo({url:"./edit?mode=add&_id=".concat(t._id),events:{add:function(t){l.refresh()}}})}),600)},updateCategory:function(){var t=[];l.table1.multipleSelection.map((function(e,a){t.push(e._id)})),c.pubfn.openForm("updateCategory",{article_ids:t})},deleteArticle:function(t){var e={mode:2===l.queryForm1.formData.status?2:1};c.pubfn.isNull(t)&&(t=c.pubfn.arrayObjectGetArray(l.table1.multipleSelection,"_id")),c.pubfn.isArray(t)?e["ids"]=t:e["ids"]=[t],c.callFunction({url:"admin/sys.article.delete",title:"请求中...",data:e,success:function(t){l.refresh()}})},recoveryArticle:function(){var t=c.pubfn.arrayObjectGetArray(l.table1.multipleSelection,"_id");c.callFunction({url:"admin/sys.article.recovery",title:"请求中...",data:{ids:t},success:function(t){l.refresh()}})},updateIsPublish:function(t){var e=c.pubfn.arrayObjectGetArray(l.table1.multipleSelection,"_id");c.callFunction({url:"admin/sys.article.updateIsPublish",title:"请求中...",data:{ids:e,is_publish:t},success:function(t){l.refresh()}})},categoryChange:function(t){l.queryForm1.formData.category_ids=t._id,l.search()},sortChange:function(t,e){c.callFunction({url:"admin/sys.article.updateSort",data:{_id:e._id,sort:Number(t)},success:function(t){}})},updateBaseInfo:function(t){c.callFunction((0,i.default)({url:"admin/sys.article.updateBaseInfo",title:"请求中..."},t))},exportArticle:function(){var t=[{value:!0,label:"是"},{value:!1,label:"否"}],e=function(t,e,a,n){var i="";return t.map((function(e,a){i+="".concat(e),t.length-1!=a&&(i+=",")})),i};this.$refs.table1.exportExcel({fileName:"文章数据",title:"正在导出数据...",pageIndex:1,pageSize:-1,columns:[{key:"sort",title:"排序",type:"number"},{key:"is_on_sale",title:"销售状态",type:"radio",data:[{value:!0,label:"上架"},{value:!1,label:"下架"}]},{key:"type",title:"文章类型",type:"radio",data:[{value:0,label:"实物"},{value:1,label:"虚拟"}]},{key:"name",title:"文章名称",type:"text"},{key:"categoryList",title:"所属分类",type:"text",formatter:function(t,e,a,n){var i="";return t.map((function(t,e){e>0&&(i+=","),i+=t.name})),i}},{key:"article_desc",title:"文章描述",type:"text"},{key:"article_thumb",title:"文章图片链接",type:"text"},{key:"article_banner_imgs",title:"文章轮播图链接",type:"text",formatter:e},{key:"article_detail_imgs",title:"文章详情页图片链接",type:"text",formatter:e},{key:"article_services",title:"服务标签",type:"text",formatter:e},{key:"is_free_delivery",title:"是否包邮",type:"radio",data:t,defaultValue:"否"},{key:"freight_id",title:"运费id",type:"text"},{key:"spec_list",title:"规格信息",type:"text",formatter:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e="";return t.map((function(a,n){e+="".concat(a.name,":"),a.list.map((function(t,n){e+="".concat(t.name),a.list.length-1!==n&&(e+=",")})),t.length-1!==n&&(e+=";")})),e}},{key:"sku_list",title:"具体规格",type:"text",formatter:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e="";return t.map((function(a,n){var i="";a.sku_name_arr.map((function(t,e){i+=t,a.sku_name_arr.length-1!==e&&(i+=",")}));var o=c.pubfn.toDecimal(a.price/100,2),l=0;a.market_price&&(l=c.pubfn.toDecimal(a.market_price/100,2)),e+="".concat(i,"::").concat(o,",").concat(l,",").concat(a.stock,",").concat(a.weight,",").concat(a.image),t.length-1!==n&&(e+=";")})),e}},{key:"is_new",title:"是否新品",type:"radio",data:t,defaultValue:"否"},{key:"is_best",title:"是否精品",type:"radio",data:t,defaultValue:"否"},{key:"is_hot",title:"是否热销",type:"radio",data:t,defaultValue:"否"},{key:"disable_vip",title:"是否禁用会员价",type:"radio",data:t,defaultValue:"否"},{key:"disable_coupon",title:"是否禁用优惠券",type:"radio",data:t,defaultValue:"否"},{key:"initial_sell_count",title:"文章初始销量",type:"text"},{key:"exp_time_mode",title:"虚拟文章有效期模式",type:"number",formatter:function(t,e,a,n){return 0==e.type?"":t}},{key:"exp_time_range",title:"虚拟文章有效期",type:"text",formatter:function(t,e,a,n){return 0==e.type?"":0===e.exp_time_mode?"长期有效":1===e.exp_time_mode?"".concat(e.exp_time_range[0],"-").concat(e.exp_time_range[1]):2===e.exp_time_mode?"".concat(e.exp_time_rule[0],"-").concat(e.exp_time_rule[1]):void 0}}]})},importArticle:function(){c.pubfn.openForm("importArticle",{item:{}})}},watch:{},computed:{}};e.default=u},"7f60":function(t,e,a){"use strict";var n=a("9788"),i=a.n(n);i.a},"8a6a":function(t,e,a){var n=a("c86c");e=n(!1),e.push([t.i,".preview-drawer-btn[data-v-0c983d89]{width:100%;bottom:10px;right:20px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:absolute}.preview-drawer-btn .table-btn.active[data-v-0c983d89],\n.preview-drawer-btn .table-btn[data-v-0c983d89]:hover{color:#409eff!important;background-color:#ecf5ff!important;border-color:#ecf5ff!important}",""]),t.exports=e},"8afb":function(t,e,a){"use strict";a.r(e);var n=a("6dec"),i=a("161a");for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);a("7f60");var l=a("828b"),r=Object(l["a"])(i["default"],n["b"],n["c"],!1,null,"0c983d89",null,!1,n["a"],void 0);e["default"]=r.exports},"94b8":function(t,e,a){"use strict";var n;a("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=uni.vk,o={props:{value:{type:Object,default:function(){return{show:!1,mode:"",item:{},url:""}}}},data:function(){return{mobile:{type:"iphone"},page:{title:"文章预览",submitText:"确定",cancelText:"关闭",showCancel:!0,top:"7vh",width:"500px"},form1:{data:{},props:{action:"",columns:[{key:"name",title:"名称",type:"text"}],rules:{},labelWidth:"100px"}}}},mounted:function(){n=this,n.init()},methods:{init:function(){var t=n,e=t.value;n.$emit("input",e)},onOpen:function(){n=this;var t=n.value.item,e=void 0===t?{}:t;n.form1.data=i.pubfn.copyObject(e)},onClose:function(){},close:function(){n.$emit("input",!1)},onFormSuccess:function(){n.value.show=!1,n.$emit("success")}},watch:{},computed:{}};e.default=o},9788:function(t,e,a){var n=a("8a6a");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var i=a("967d").default;i("3d6a4ed4",n,!0,{sourceMap:!1,shadowMode:!1})},ab3f3:function(t,e,a){"use strict";var n=a("d5c66"),i=a.n(n);i.a},d5c66:function(t,e,a){var n=a("45a3");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var i=a("967d").default;i("2d03f217",n,!0,{sourceMap:!1,shadowMode:!1})}}]);